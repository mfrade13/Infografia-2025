{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Nancy\\\\Documents\\\\UNIVERSIDAD\\\\SEPTIMO_SEMESTRE\\\\INFOGRAFIA\\\\object-detection-app\\\\frontend\\\\src\\\\components\\\\WebcamDetector.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { io } from 'socket.io-client';\nimport './WebcamDetector.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst WebcamDetector = ({\n  onDetection\n}) => {\n  _s();\n  const [isDetecting, setIsDetecting] = useState(false);\n  const [fps, setFps] = useState(10);\n  const videoRef = useRef(null);\n  const socketRef = useRef(null);\n  const animationRef = useRef(null);\n  const frameQueue = useRef([]);\n  const lastFrameTime = useRef(0);\n\n  // Inicializar Socket.IO\n  useEffect(() => {\n    socketRef.current = io('http://localhost:5000', {\n      transports: ['websocket'],\n      reconnectionAttempts: 5,\n      reconnectionDelay: 1000\n    });\n    socketRef.current.on('video_frame', data => {\n      if (frameQueue.current.length < 2) {\n        // Limitar el buffer a 2 frames\n        frameQueue.current.push(data);\n      }\n    });\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.disconnect();\n      }\n      cancelAnimationFrame(animationRef.current);\n    };\n  }, []);\n\n  // Procesamiento de frames con requestAnimationFrame\n  const processFrames = () => {\n    const now = performance.now();\n    const frameInterval = 1000 / fps;\n    if (frameQueue.current.length > 0 && now - lastFrameTime.current >= frameInterval) {\n      const frameData = frameQueue.current.shift();\n      if (videoRef.current) {\n        videoRef.current.src = `data:image/jpeg;base64,${frameData.frame}`;\n      }\n      if (onDetection) {\n        onDetection({\n          type: 'video',\n          frame: `data:image/jpeg;base64,${frameData.frame}`,\n          results: frameData.results\n        });\n      }\n      lastFrameTime.current = now;\n    }\n    animationRef.current = requestAnimationFrame(processFrames);\n  };\n  useEffect(() => {\n    animationRef.current = requestAnimationFrame(processFrames);\n    return () => cancelAnimationFrame(animationRef.current);\n  }, [fps]);\n  const toggleDetection = () => {\n    if (isDetecting) {\n      socketRef.current.emit('stop_video');\n    } else {\n      frameQueue.current = []; // Limpiar el buffer al iniciar\n      socketRef.current.emit('start_video', {\n        fps\n      });\n    }\n    setIsDetecting(!isDetecting);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"webcam-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Live Object Detection\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-wrapper\",\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        ref: videoRef,\n        alt: \"Live camera feed\",\n        className: \"video-feed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleDetection,\n        className: `detect-button ${isDetecting ? 'active' : ''}`,\n        children: isDetecting ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"recording-dot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 29\n          }, this), \"Stop Detection\"]\n        }, void 0, true) : 'Start Detection'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"fps-control\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: [\"FPS: \", fps]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"range\",\n          min: \"1\",\n          max: \"15\",\n          value: fps,\n          onChange: e => setFps(parseInt(e.target.value)),\n          disabled: isDetecting\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 9\n  }, this);\n};\n_s(WebcamDetector, \"oZIRWz899/cu6deA5+LDLXmo9bA=\");\n_c = WebcamDetector;\nexport default WebcamDetector;\nvar _c;\n$RefreshReg$(_c, \"WebcamDetector\");","map":{"version":3,"names":["React","useState","useEffect","useRef","io","jsxDEV","_jsxDEV","Fragment","_Fragment","WebcamDetector","onDetection","_s","isDetecting","setIsDetecting","fps","setFps","videoRef","socketRef","animationRef","frameQueue","lastFrameTime","current","transports","reconnectionAttempts","reconnectionDelay","on","data","length","push","disconnect","cancelAnimationFrame","processFrames","now","performance","frameInterval","frameData","shift","src","frame","type","results","requestAnimationFrame","toggleDetection","emit","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","alt","onClick","min","max","value","onChange","e","parseInt","target","disabled","_c","$RefreshReg$"],"sources":["C:/Users/Nancy/Documents/UNIVERSIDAD/SEPTIMO_SEMESTRE/INFOGRAFIA/object-detection-app/frontend/src/components/WebcamDetector.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { io } from 'socket.io-client';\r\nimport './WebcamDetector.css';\r\n\r\nconst WebcamDetector = ({ onDetection }) => {\r\n    const [isDetecting, setIsDetecting] = useState(false);\r\n    const [fps, setFps] = useState(10);\r\n    const videoRef = useRef(null);\r\n    const socketRef = useRef(null);\r\n    const animationRef = useRef(null);\r\n    const frameQueue = useRef([]);\r\n    const lastFrameTime = useRef(0);\r\n\r\n    // Inicializar Socket.IO\r\n    useEffect(() => {\r\n        socketRef.current = io('http://localhost:5000', {\r\n            transports: ['websocket'],\r\n            reconnectionAttempts: 5,\r\n            reconnectionDelay: 1000,\r\n        });\r\n\r\n        socketRef.current.on('video_frame', (data) => {\r\n            if (frameQueue.current.length < 2) { // Limitar el buffer a 2 frames\r\n                frameQueue.current.push(data);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            if (socketRef.current) {\r\n                socketRef.current.disconnect();\r\n            }\r\n            cancelAnimationFrame(animationRef.current);\r\n        };\r\n    }, []);\r\n\r\n    // Procesamiento de frames con requestAnimationFrame\r\n    const processFrames = () => {\r\n        const now = performance.now();\r\n        const frameInterval = 1000 / fps;\r\n\r\n        if (frameQueue.current.length > 0 && now - lastFrameTime.current >= frameInterval) {\r\n            const frameData = frameQueue.current.shift();\r\n            \r\n            if (videoRef.current) {\r\n                videoRef.current.src = `data:image/jpeg;base64,${frameData.frame}`;\r\n            }\r\n\r\n            if (onDetection) {\r\n                onDetection({\r\n                    type: 'video',\r\n                    frame: `data:image/jpeg;base64,${frameData.frame}`,\r\n                    results: frameData.results\r\n                });\r\n            }\r\n\r\n            lastFrameTime.current = now;\r\n        }\r\n\r\n        animationRef.current = requestAnimationFrame(processFrames);\r\n    };\r\n\r\n    useEffect(() => {\r\n        animationRef.current = requestAnimationFrame(processFrames);\r\n        return () => cancelAnimationFrame(animationRef.current);\r\n    }, [fps]);\r\n\r\n    const toggleDetection = () => {\r\n        if (isDetecting) {\r\n            socketRef.current.emit('stop_video');\r\n        } else {\r\n            frameQueue.current = []; // Limpiar el buffer al iniciar\r\n            socketRef.current.emit('start_video', { fps });\r\n        }\r\n        setIsDetecting(!isDetecting);\r\n    };\r\n\r\n    return (\r\n        <div className=\"webcam-container\">\r\n            <h2>Live Object Detection</h2>\r\n            \r\n            <div className=\"video-wrapper\">\r\n                <img \r\n                    ref={videoRef}\r\n                    alt=\"Live camera feed\"\r\n                    className=\"video-feed\"\r\n                />\r\n            </div>\r\n            \r\n            <div className=\"controls\">\r\n                <button \r\n                    onClick={toggleDetection}\r\n                    className={`detect-button ${isDetecting ? 'active' : ''}`}\r\n                >\r\n                    {isDetecting ? (\r\n                        <>\r\n                            <span className=\"recording-dot\"></span>\r\n                            Stop Detection\r\n                        </>\r\n                    ) : 'Start Detection'}\r\n                </button>\r\n                \r\n                <div className=\"fps-control\">\r\n                    <label>FPS: {fps}</label>\r\n                    <input\r\n                        type=\"range\"\r\n                        min=\"1\"\r\n                        max=\"15\"\r\n                        value={fps}\r\n                        onChange={(e) => setFps(parseInt(e.target.value))}\r\n                        disabled={isDetecting}\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WebcamDetector;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,EAAE,QAAQ,kBAAkB;AACrC,OAAO,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE9B,MAAMC,cAAc,GAAGA,CAAC;EAAEC;AAAY,CAAC,KAAK;EAAAC,EAAA;EACxC,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGZ,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACa,GAAG,EAAEC,MAAM,CAAC,GAAGd,QAAQ,CAAC,EAAE,CAAC;EAClC,MAAMe,QAAQ,GAAGb,MAAM,CAAC,IAAI,CAAC;EAC7B,MAAMc,SAAS,GAAGd,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMe,YAAY,GAAGf,MAAM,CAAC,IAAI,CAAC;EACjC,MAAMgB,UAAU,GAAGhB,MAAM,CAAC,EAAE,CAAC;EAC7B,MAAMiB,aAAa,GAAGjB,MAAM,CAAC,CAAC,CAAC;;EAE/B;EACAD,SAAS,CAAC,MAAM;IACZe,SAAS,CAACI,OAAO,GAAGjB,EAAE,CAAC,uBAAuB,EAAE;MAC5CkB,UAAU,EAAE,CAAC,WAAW,CAAC;MACzBC,oBAAoB,EAAE,CAAC;MACvBC,iBAAiB,EAAE;IACvB,CAAC,CAAC;IAEFP,SAAS,CAACI,OAAO,CAACI,EAAE,CAAC,aAAa,EAAGC,IAAI,IAAK;MAC1C,IAAIP,UAAU,CAACE,OAAO,CAACM,MAAM,GAAG,CAAC,EAAE;QAAE;QACjCR,UAAU,CAACE,OAAO,CAACO,IAAI,CAACF,IAAI,CAAC;MACjC;IACJ,CAAC,CAAC;IAEF,OAAO,MAAM;MACT,IAAIT,SAAS,CAACI,OAAO,EAAE;QACnBJ,SAAS,CAACI,OAAO,CAACQ,UAAU,CAAC,CAAC;MAClC;MACAC,oBAAoB,CAACZ,YAAY,CAACG,OAAO,CAAC;IAC9C,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMU,aAAa,GAAGA,CAAA,KAAM;IACxB,MAAMC,GAAG,GAAGC,WAAW,CAACD,GAAG,CAAC,CAAC;IAC7B,MAAME,aAAa,GAAG,IAAI,GAAGpB,GAAG;IAEhC,IAAIK,UAAU,CAACE,OAAO,CAACM,MAAM,GAAG,CAAC,IAAIK,GAAG,GAAGZ,aAAa,CAACC,OAAO,IAAIa,aAAa,EAAE;MAC/E,MAAMC,SAAS,GAAGhB,UAAU,CAACE,OAAO,CAACe,KAAK,CAAC,CAAC;MAE5C,IAAIpB,QAAQ,CAACK,OAAO,EAAE;QAClBL,QAAQ,CAACK,OAAO,CAACgB,GAAG,GAAG,0BAA0BF,SAAS,CAACG,KAAK,EAAE;MACtE;MAEA,IAAI5B,WAAW,EAAE;QACbA,WAAW,CAAC;UACR6B,IAAI,EAAE,OAAO;UACbD,KAAK,EAAE,0BAA0BH,SAAS,CAACG,KAAK,EAAE;UAClDE,OAAO,EAAEL,SAAS,CAACK;QACvB,CAAC,CAAC;MACN;MAEApB,aAAa,CAACC,OAAO,GAAGW,GAAG;IAC/B;IAEAd,YAAY,CAACG,OAAO,GAAGoB,qBAAqB,CAACV,aAAa,CAAC;EAC/D,CAAC;EAED7B,SAAS,CAAC,MAAM;IACZgB,YAAY,CAACG,OAAO,GAAGoB,qBAAqB,CAACV,aAAa,CAAC;IAC3D,OAAO,MAAMD,oBAAoB,CAACZ,YAAY,CAACG,OAAO,CAAC;EAC3D,CAAC,EAAE,CAACP,GAAG,CAAC,CAAC;EAET,MAAM4B,eAAe,GAAGA,CAAA,KAAM;IAC1B,IAAI9B,WAAW,EAAE;MACbK,SAAS,CAACI,OAAO,CAACsB,IAAI,CAAC,YAAY,CAAC;IACxC,CAAC,MAAM;MACHxB,UAAU,CAACE,OAAO,GAAG,EAAE,CAAC,CAAC;MACzBJ,SAAS,CAACI,OAAO,CAACsB,IAAI,CAAC,aAAa,EAAE;QAAE7B;MAAI,CAAC,CAAC;IAClD;IACAD,cAAc,CAAC,CAACD,WAAW,CAAC;EAChC,CAAC;EAED,oBACIN,OAAA;IAAKsC,SAAS,EAAC,kBAAkB;IAAAC,QAAA,gBAC7BvC,OAAA;MAAAuC,QAAA,EAAI;IAAqB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAE9B3C,OAAA;MAAKsC,SAAS,EAAC,eAAe;MAAAC,QAAA,eAC1BvC,OAAA;QACI4C,GAAG,EAAElC,QAAS;QACdmC,GAAG,EAAC,kBAAkB;QACtBP,SAAS,EAAC;MAAY;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACzB;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC,eAEN3C,OAAA;MAAKsC,SAAS,EAAC,UAAU;MAAAC,QAAA,gBACrBvC,OAAA;QACI8C,OAAO,EAAEV,eAAgB;QACzBE,SAAS,EAAE,iBAAiBhC,WAAW,GAAG,QAAQ,GAAG,EAAE,EAAG;QAAAiC,QAAA,EAEzDjC,WAAW,gBACRN,OAAA,CAAAE,SAAA;UAAAqC,QAAA,gBACIvC,OAAA;YAAMsC,SAAS,EAAC;UAAe;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC,kBAE3C;QAAA,eAAE,CAAC,GACH;MAAiB;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACjB,CAAC,eAET3C,OAAA;QAAKsC,SAAS,EAAC,aAAa;QAAAC,QAAA,gBACxBvC,OAAA;UAAAuC,QAAA,GAAO,OAAK,EAAC/B,GAAG;QAAA;UAAAgC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACzB3C,OAAA;UACIiC,IAAI,EAAC,OAAO;UACZc,GAAG,EAAC,GAAG;UACPC,GAAG,EAAC,IAAI;UACRC,KAAK,EAAEzC,GAAI;UACX0C,QAAQ,EAAGC,CAAC,IAAK1C,MAAM,CAAC2C,QAAQ,CAACD,CAAC,CAACE,MAAM,CAACJ,KAAK,CAAC,CAAE;UAClDK,QAAQ,EAAEhD;QAAY;UAAAkC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACD,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEd,CAAC;AAACtC,EAAA,CA/GIF,cAAc;AAAAoD,EAAA,GAAdpD,cAAc;AAiHpB,eAAeA,cAAc;AAAC,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}